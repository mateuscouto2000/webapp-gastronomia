<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - App</title>
    <link rel="stylesheet" href="../static/dash.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
      

    <style>

        .valorjquery 
            /* padding: 0; */
        

        .details {
            display: none;
        }

        .expand-btn {
            /* position: absolute; */
            right: 0;
            bottom: 0;
            padding: 2px 5px;
            background-color: transparent;
            border: none;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="app-container">
        <div class="app-left">
            <button class="close-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-x">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </button>
            <div class="app-logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-bar-chart-2">
                    <line x1="18" y1="20" x2="18" y2="10" />
                    <line x1="12" y1="20" x2="12" y2="4" />
                    <line x1="6" y1="20" x2="6" y2="14" />
                </svg>
                <span>Divinos Sabores</span>
            </div>
            <ul class="nav-list">
                <li class="nav-list-item active">
                    <a class="nav-list-link" href="#">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-columns">
                            <path
                                d="M12 3h7a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-7m0-18H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7m0-18v18" />
                        </svg>
                        Dashboard
                    </a>
                </li>
                <li class="nav-list-item active">
                    <a class="nav-list-link" href="#" data-toggle="modal" data-target="#modalExemplo">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-file">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" />
                            <polyline points="13 2 13 9 20 9" />
                        </svg>
                        Cadastrar Produto
                    </a>
                </li>
                <li class="nav-list-item active">
                    <a class="nav-list-link" href="/cadastro/adm">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-users">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="9" cy="7" r="4" />
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                        </svg>
                        Cadastrar Administrador
                    </a>
                </li>
                <li class="nav-list-item active">
                    <a class="nav-list-link" href="#" data-toggle="modal" data-target="#modalGerenciar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-pie-chart">
                            <path d="M21.21 15.89A10 10 0 1 1 8 2.83" />
                            <path d="M22 12A10 10 0 0 0 12 2v10z" />
                        </svg>
                        Gerenciar Cardápio
                    </a>
                </li>
            </ul>
        </div>
        <div class="app-main">
            <div class="main-header-line">
                <h1>Dashboard</h1>
                <div class="action-buttons">
                    <button class="open-right-area">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-activity">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg>
                    </button>
                    <button class="menu-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-menu">
                            <line x1="3" y1="12" x2="21" y2="12" />
                            <line x1="3" y1="6" x2="21" y2="6" />
                            <line x1="3" y1="18" x2="21" y2="18" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="chart-row three">
                <div class="chart-container-wrapper">
                    <div class="chart-container">
                        <div class="chart-info-wrapper">
                            <h2>Pendetes</h2>
                            <span>{{dados['total_pendentes']}}</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container-wrapper">
                    <div class="chart-container">
                        <div class="chart-info-wrapper">
                            <h2>Cardapio itens</h2>
                            <span>{{dados['itens_ativos_no_cardapio']}}</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container-wrapper">
                    <div class="chart-container">
                        <div class="chart-info-wrapper">
                            <h2>Pedidos entrega</h2>
                            <span>{{dados['quantide_pendentes_para_entrega']}}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-row three">
                <div class="chart-container-wrapper">
                    <div class="chart-container">
                        <div class="chart-info-wrapper">
                            <h2>Pedidos Pagos</h2>
                            <span>{{dados['total_pagos']}}</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container-wrapper">
                    <div class="chart-container">
                        <div class="chart-info-wrapper">
                            <h2>Finalizados</h2>
                            <span>{{dados['total_finalizados']}}</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container-wrapper">
                    <div class="chart-container">
                        <div class="chart-info-wrapper">
                            <h2>Valor Faturado</h2>
                            <span>R$ {{dados['total_faturado']}}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-row two">
                <div class="chart-container-wrapper big">
                    <div class="chart-container">
                        <div class="chart-container-header">
                            <h2>Pedidos Pendentes (Local)</h2>
                        </div>
                        <table class="table table-sm table-dark">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Mesa</th>
                                    <th scope="col">Item</th>
                                    <th scope="col">Cliente</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if dados['pedidos_pendentes_para_comer_no_local']|length > 0 %}

                                {% for pedido in dados['pedidos_pendentes_para_comer_no_local'] %}
                                <tr>
                                    <th scope="row">{{ loop.index }}</th>
                                    <td>{{pedido['mesa']}}</td>
                                    <td>{{pedido['quantidade_item_pedido']}}x | {{pedido['item_cardapio']['nome']}}</td>
                                    <td>{{pedido['nome_usuario']}}</td>
                                    <td><a href="/pedidos/finalizar/?id={{pedido['_id']}}"><button type="button" class="btn btn-success">Entregue</button></a></td>
                                </tr>
                                {% endfor %}

                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>


            <div class="chart-row two">
                <div class="chart-container-wrapper big">
                    <div class="chart-container">
                        <div class="chart-container-header">
                            <h2>Pedidos Pendentes (DELIVERY)</h2>
                        </div>
                        <table class="table table-sm table-dark">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Endereço</th>
                                    <th scope="col">Item</th>
                                    <th scope="col">Cliente</th>
                                    <th scope="col">Telefone cliente</th>
                                </tr>
                            </thead>
                            <tbody>

                                {% if dados['pedidos_pendentes_para_entrega']|length > 0 %}

                                {% for pedido in dados['pedidos_pendentes_para_entrega'] %}
                                <tr>
                                    <th scope="row">{{ loop.index }}</th>
                                    <td>{{pedido['rua_entrega'] + "," + pedido['cep_entrega'] + "," +
                                        pedido['numero_endereco_entrega'] + "," + pedido['cidade'] + "," +
                                        pedido['bairro'] }}</td>
                                    <td>{{pedido['item_cardapio']['nome']}}</td>
                                    <td>{{pedido['nome_usuario']}}</td>
                                    <td>{{pedido['telefone_contato']}}</td>
                                    <td><a href="/pedidos/finalizar/?id={{pedido['_id']}}"><button type="button" class="btn btn-success">Finalizado</button></a></td>
                                </tr>
                                {% endfor %}

                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="chart-row two">
                <div class="chart-container-wrapper big">
                    <div class="chart-container">
                        <div class="chart-container-header">
                            <h2>Aguardando Pagamento</h2>
                        </div>
                        <table class="table table-sm table-dark">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Mesa</th>
                                    <th scope="col">Item</th>
                                    <th scope="col">Cliente</th>
                                    <th scope="col">Valor</th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                            <tbody>

                                {% if dados['pedidos_para_pagar']|length > 0 %}

                                {% for pedido in dados['pedidos_para_pagar'] %}
                                <tr>
                                    <th scope="row">{{ loop.index }}</th>
                                    <td>{{pedido['mesa']}}</td>
                                    <!-- <td>{{pedido['nomes_itens_formatado']}}</td> -->
                                    
                                    <td>
                                        <button class="btn btn-secondary expand-btn">+</button>
                                        <div class="details">
                                            {{pedido['nomes_itens_formatado']}}
                                        </div>
                                    </td>

                                    <td>{{pedido['cliente']}}</td>
                                    <td>R$ {{pedido['valor_total_cliente']}}</td>
                                    <td><a href="/pedidos/pagarusuario/?id={{pedido['usuario_id']}}"><button type="button" class="btn btn-success">Finalizado</button></a></td>
                                </tr>
                                {% endfor %}

                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="modalExemplo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="background-color: #947f17;">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Cadastro novo item no cardapio</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('cardapio.cadastro_item_cardapio') }}" method="post"
                                enctype="multipart/form-data">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Nome</label>
                                    <input type="text" class="form-control" id="nome_item" name="nome_item"
                                        aria-describedby="emailHelp" placeholder="Nome do item">
                                </div>
                                <div class="form-group">
                                    <label for="exampleInputPassword1">Valor (R$)</label>
                                    <!-- <input type="number" class="form-control" id="valor" name="valor"
                                        placeholder="Valor"> -->

                                    <input type="text" class="form-control valorjquery" id="valor" name="valor" placeholder="Valor" required>
                                </div>

                                <div class="form-group">
                                    <label for="exampleInputPassword1">Quantidade disponivel</label>
                                    <input type="number" class="form-control" id="quantidade" name="quantidade"
                                        placeholder="Quantidade">
                                </div>

                                <select class="custom-select" id="tipoAlimento" name="tipoAlimento">
                                    <option selected>Tipo de Alimento</option>
                                    <option value="salgados">Salgado</option>
                                    <option value="sobremesas">Sobremesa</option>
                                    <option value="bebida">Bebida</option>
                                </select><br><br>

                                <div class="form-group">
                                    <input accept=".png, .gif" type="file" id="file" name="file">
                                </div>

                                <button type="submit" class="btn btn-dark">Cadastrar</button>

                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="modalGerenciar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog" role="document" style="align-items: center;">
                    <div class="modal-content"
                        style="background-color: #947f17;width: 800px;justify-content: center;display: flex;align-items: center;">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Lista de itens ativos no cardápio</h5>
                        </div>
                        <div class="modal-body">
                            <table class="table table-striped table-dark">
                                <thead>
                                    <tr>
                                        <th scope="col">Nome</th>
                                        <th scope="col">Valor</th>
                                        <th scope="col">Quant.</th>
                                        <!-- <th scope="col">ID</th> -->
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if dados['todo_cardapio']|length > 0 %}
                                    {% for item in dados['todo_cardapio'] %}
                                    <tr>
                                        <td>{{item['nome']}}</td>
                                        <td>{{item['valor']}}</td>
                                        <td>{{item['quantidade']}}</td>
                                        <!-- <td id="item_id">{{item['_id']}}</td> -->
                                        <td><button type="button" class="btn btn-success" data-toggle="modal"
                                                data-target="#{{item['nome']|replace(' ', '')}}">Atualizar</button></td>
                                        <td><a href="/cardapio/deletar/?id={{item['_id']}}"><button class="btn btn-danger">Deletar</button></a></td>
                                    </tr>
                                    {% endfor %}
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            {% if dados['todo_cardapio']|length > 0 %}
            {% for item in dados['todo_cardapio'] %}
            <div class="modal fade" id="{{item['nome']|replace(' ', '')}}" tabindex="-1" role="dialog"
                aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="background-color: #d5a71ced">
                        <div class="modal-header">
                            <h5 class="modal-title">Gerenciar Itens</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="{{ url_for('cardapio.atulizar_cardapio') }}" method="post">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Nome</label>
                                    <input type="text" class="form-control" id="nome_item" name="nome_item"
                                        aria-describedby="emailHelp" placeholder="Nome" value="{{item['nome']}}">
                                </div>

                                <div class="form-group">
                                    <label for="exampleInputPassword1">Valor (R$)</label>
                                    <!-- <input type="number" class="form-control" id="valor" name="valor"
                                        placeholder="Valor" value="{{item['valor_num']}}"> -->
                                    <input type="text" class="form-control valorjquery" id="valor" name="valor" placeholder="Valor" value="{{item['valor']}}" required>
                                    <!-- value="{{item['valor']}}" -->
                                </div>

                                <div class="form-group">
                                    <label for="exampleInputPassword1">Quantidade</label>
                                    <input type="number" class="form-control" id="quantidade" name="quantidade"
                                        placeholder="Quantidade" value="{{item['quantidade']}}">
                                </div>

                                <div class="form-group">
                                    <select class="custom-select" id="tipoAlimentoAtt" name="tipoAlimentoAtt">
                                        <option disabled selected>Tipo de Alimento</option>
                                        <option value="salgados" {% if item['tipo_alimento'] == 'salgados' %} selected {% endif %}>Salgado</option>
                                        <option value="sobremesas" {% if item['tipo_alimento'] == 'sobremesas' %} selected {% endif %}>Sobremesa</option>
                                        <option value="bebida" {% if item['tipo_alimento'] == 'bebida' %} selected {% endif %}>Bebida</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="exampleInputPassword1">Item ID (Não mude esse id)</label>
                                    <input type="text" class="form-control" id="id" name="id" placeholder="ID"
                                        value="{{item['_id']}}" readonly>
                                </div>

                                <button type="submit" class="btn btn-primary">Salvar
                                    Mudanças</button>
                            </form>
                            <br>
                            <button class="btn btn-danger" onclick="deletar(document.getElementById('id').value)">Deletar</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}

        </div>
        <script src="../static/dash.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>

        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

        <script>
            function getCookie(name) {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith(name + '=')) {
                        return cookie.substring(name.length + 1);
                    }
                }
                return null;
            }


            usuarioLogado = getCookie('usuarioLogado')
            validar_usuario(usuarioLogado)
            function validar_usuario(usuarioLogado) {
                if (!usuarioLogado) {
                    window.location = '/'
                }
            }

            var deletar = async (id) => {
                await fetch('http://127.0.0.1:5000/cardapio/deletar/?id='+id, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                })
                    .then(resultado => {
                        location.reload(true);
                    })

            }

            var finalizar = async (id) => {
                await fetch('http://127.0.0.1:5000/pedidos/finalizar/?id='+id, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                })
                    .then(resultado => {
                        location.reload(true);
                    })

            }

            var pagarusuario = async (id) => {
                await fetch('http://127.0.0.1:5000/pedidos/pagarusuario/?id='+id, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                })
                    .then(resultado => {
                        location.reload(true);
                    })

            }

            const expandButtons = document.querySelectorAll('.expand-btn');
            expandButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const details = button.nextElementSibling;
                    if (details.style.display === 'block') {
                        details.style.display = 'none';
                        button.textContent = '+';
                    } else {
                        details.style.display = 'block';
                        button.textContent = '-';
                    }
                });
            });

            // $(function() {
            //     $("#valor").maskMoney({prefix:'R$ ', allowNegative: true, thousands:'.', decimal:',', affixesStay: false});
            // })

            $(document).ready(function() {
                $('.valorjquery').mask('R$ 0.000.000.000,00', {reverse: true});
            });
        </script>
</body>

</html>